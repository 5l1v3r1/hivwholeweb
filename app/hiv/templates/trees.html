{% extends "base.html" %}
{% block head_end %}
 <script src="http://d3js.org/d3.v3.min.js" type="text/javascript"></script>
<script type="text/javascript" src="/static/js/d3.phylogram.js/newick.js"></script>
<script type="text/javascript" src="/static/js/d3.phylogram.js/d3.phylogram.js"></script>
<script>
{% for tree in trees %}
   function load_{{tree.name}}() {
     var newick = Newick.parse("{{tree.newick}}")
     var newickNodes = []
     function buildNewickNodes(node, callback) {
       newickNodes.push(node)
       if (node.branchset) {
         for (var i=0; i < node.branchset.length; i++) {
           buildNewickNodes(node.branchset[i])
         }
       }
     }
     buildNewickNodes(newick)
     d3.phylogram.build('#phylogram_{{tree.name}}', newick, {
       width: 400,
       height: 300
     });
   }
{% endfor %}

function load() {
   {% for tree in trees %}load_{{tree.name}}();{% endfor %}
}
</script>
{% endblock %}
{% block body_attributes %}onload="load()"{% endblock %}
{% block content %}
 <h1>Phylogenetic trees</h1>
 {% for tree in trees %}
   <h3>{{tree.name}}</h3>
   <div id='phylogram_{{tree.name}}'></div>
 {% endfor %}
 <br>
 
 <hl>Select options:</hl>
 <form action="" method="post" name="tree_settings">
  {{form.hidden_tag()}}
  <p>
    Fragments: F1 {{form.F1}} F2 {{form.F2}} F3 {{form.F3}} F4 {{form.F4}} F5 {{form.F5}} F6 {{form.F6}}
    <!--
    {% for error in form.errors.fragment %}
     <span style="color: red;">[{{error}}]</span>
    {% endfor %}
    -->
    <br>
  </p>
  <p><input type="submit" value="Plot"></p>
 </form>
{% endblock %}
