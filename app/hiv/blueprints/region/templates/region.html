{% extends "regionPlots.html" %}
{% block content %}

<div class="container-fluid" style="padding:20px">

<!-- sidebar -->
<div class="col-xs-2 col-sm-2 col-md-2 col-lg-2">
  <div class="panel panel-default" style="width:110px; text-align:center">
    <div class="panel-heading">
      <b class="text-primary"><span class="glyphicon glyphicon-zoom-in"></span> Regions</b>
    </div>
    <div class="list-group">
      {% for rtmp in regions %}
      {% if rtmp == region %}
      <a href="/region/{{rtmp}}" class="list-group-item active">{{rtmp}}</a>
      {% else %}
      <a href="/region/{{rtmp}}" class="list-group-item">{{rtmp}}</a>
      {% endif %}
      {% endfor %}
    </div> 
  </div>
</div>
<div class="clearfix visible-xs-block"></div>

<!-- content -->
<div class="col-xs-9 col-sm-9 col-md-9 col-lg-9 ">
  <!-- header -->
  <div class="panel panel-default">
    <div class="panel-body text-primary" style="text-align:center">
      <h4><span class="glyphicon glyphicon-zoom-in"></span> <b>{{region}}</b></h4>
    </div>
  </div>
  <!-- already expanded panels --> 
  <div class="panel-group">
    <!-- Intro -->
    <div class="panel panel-default">
      <div class="panel-heading"> 
      <span class="text-primary glyphicon glyphicon-question-sign"></span> <a data-toggle="collapse" href="#Intro">Introduction</a>
      </div>
      <div id="Intro" class="panel-collapse collapse in">
        <div class="panel-body" style="text-align:justify">
        <!-- Intro text -->  
		        text  
        </div>
      </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading"> 
      <span class="text-primary text-primary glyphicon glyphicon-info-sign"></span> <a data-toggle="collapse" href="#Sum">Location</a>
      </div>
    <div id="Sum" class="panel-collapse collapse in">
      <div class="panel-body">
      <!-- Summary content -->
        <div class="row">
	  <div class="col-xs-12">
            <svg class="d3-plot" id="genomeSvg{{region}}" style="padding-bottom:20px"></svg>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12">
            <div class="form-group form-inline" align="center">
             <label>Patient:</label>
             <select class="form-control locationPname">
               {% for pname in pnames %}
                <option>{{pname}}</option>
               {% endfor %} 
             </select>
            </div>
          </div>
        </div>
      </div>
    </div>
   </div>    
   <!-- expand nav -->
   <div class="panel panel-default"> 
      <div class="panel-heading">
         <span class="text-primary text-primary glyphicon glyphicon-minus"></span>
         <a data-toggle="collapse" data-parent="#expand" href="#top1">Topic 1</a>
      </div>
      <div id="top1" class="panel-collapse collapse">
        <div class="panel-body">
          content 1
        </div>
      </div>
    </div>
    <div class="panel panel-default"> 
      <div class="panel-heading">
        <span class="text-primary text-primary glyphicon glyphicon-minus"></span>
        <a data-toggle="collapse" data-parent="#expand" href="#top2">Topic 2</a>
      </div>
      <div id="top2" class="panel-collapse collapse">
        <div class="panel-body">
          content 2
        </div>
      </div>
    </div>
</div>

</div>
</div>

<!-- Scripts at the end of page load -->
<script type="text/javascript" src="/static/js/genome.js"></script>
<script type="text/javascript">
function loadGenome(id, pname, highlight) {
    d3.xhr("/method/genomes/")
   .header("Content-Type", "application/json")
   .post(
     JSON.stringify({patient: pname}),
     function(error, request) {
      var data = JSON.parse(request.responseText);
      data = {pname: pname, genome: data.data};
      if (highlight)
          data.highlightedRegions = ["{{region}}"];
      updateGenome(id, data);
     }
  );
}
</script>

<!-- load at page opening -->
<script>
//FIXME: get the pname from a form or so
var pname = $('.locationPname option:selected').val();
loadGenome("genomeSvg{{region}}", pname, true);
</script>

<!-- jquery event handling for selections (trees, etc) -->
<script>
$('select.locationPname').on('change', function(){
    var pname = $('.locationPname option:selected').val();
    emptyGenome("genomeSvg{{region}}");
    loadGenome("genomeSvg{{region}}", pname, true);
});
</script>


{% endblock %}
