{% extends "base.html" %}
{% block head_end %}
{{ super() }}
<!-- display message if javascript is disabled -->
<noscript>
  <div class="bg-danger" style="margin-left:50px; margin-right:50px; margin-top:20px;
  margin-bottom:20px; padding-top:20px; padding-left:20px; padding-bottom:20px">
  <p class="text-danger"><span class="glyphicon glyphicon-warning-sign"></span><strong> Warning:</strong> You don't have JavaScript activated. For full functionality of our site JavaScript has to be enabled.</p>
  <a href="http://www.enable-javascript.com/" target="_blank">How to enable JavaScript?</a>
</div>
</noscript>

<!-- D3.js for plots -->
<link href="/static/css/d3_plots.css" rel="stylesheet" type="text/css">
<script src="/static/components/d3/d3.js" charset="utf-8"></script>

<!-- d3-tip for tooltips -->
<link rel="stylesheet" href="/static/css/d3-tip.css">
<script type="text/javascript" src="/static/components/d3-tip/index.js"></script>

<!-- maybe we have to put the snippet directly into single scripts, let's hope not -->
<script type="text/javascript">
  <!-- nice IE has no way of finding a string in a list of strings (!) -->
  if (!Array.prototype.indexOf) {
   Array.prototype.indexOf = function(item) {
    var i = this.length;
    while (i--) {
     if (this[i] === item) return i;
   }
   return -1;
 }
}

<!-- JavaScript has no intrinsic way to determine numeric -->
function isNumeric(n) {
 return !isNaN(parseFloat(n)) && isFinite(n);
}
</script>


<script type="text/javascript" src="/static/js/trees.js"></script>
<script type="text/javascript">
  function loadTree(id, pname, region) {
   d3.xhr("/method/trees/")
   .header("Content-Type", "application/json")
   .post(
    JSON.stringify({patient: pname, region: region, treeFormat: "json"}),
    function(error, request) {
     var data = JSON.parse(request.responseText);
     d3.json(data.tree, function(error, tree) {
      data.tree = tree;      
      data.pname = pname;
      data.region = region;
      data.leafLabels = false;
      data.optimizeSpace = true;
      data.tipMuts = false;
      updateTree(id, data);
    });     
   });
 }

 function load() {
   loadTree("treeSvgAll", "all", "{{region}}");
 }
</script>
{% endblock %}
{% block body_attributes %}onload="load()"{% endblock %}
{% block content %}
<div class="container">
  <div class="jumbotron">
   <h2 class="text-primary"><b>HIV EVO</b> <small><b>Intrapatient HIV evolution</b></small></h2>
 </div>
 <div class="row">
  <div class="col-xs-6">   
   <h4 class="subheader text-muted"><span class="glyphicon glyphicon-info-sign"></span> Deep longitudinal data</h4>
   <hr>
   <ul>
    <li> 10 patients </li>
    <li> more than 80 time points </li>
    <li> whole genome </li>
    <li> coverage >1000 with quantified template input </li>
  </ul>
</div>
<div class="col-xs-6">
  <h4 class="subheader text-muted"><span class="glyphicon glyphicon-question-sign"></span> How to access and explore</h4>
  <hr>
  <ul>
    <li> Browse data by <a href="/patient/p1/">patient</a></li>
    <li> Compare patients and <a href="/region/V3/">genomic regions</a></li>
    <li> The sequencing <a href="/method/">methods</a> and quality <a href="/controls/">controls</a></li>
    <li> <a href="/data/">Download</a> the cleaned reads </li>
  </ul>
</div>
</div>
<div class="panel panel-default" style="margin-top:20px">    
  <div class="panel-body">
    <div class="col-md-6">
      <h5 class="text-muted" style="text-align:center"><b>Table:</b> Overview of patient specific data.</h5>
      <div style="padding:20px">
        <table class="table" style="text-align:right">
          <thead>
            <tr>
              <th rowspan="2">Patient</th>
              <th rowspan="2">Subtype</th>
              <th rowspan="2">&#35; samples</th>
              <th rowspan="2">1st sample</th>
              <th rowspan="2">Last sample</th>
              <th rowspan="2"></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td colspan="2" align="center">[days since infection]</td>
              <td></td>
            </tr>
            {% for row in patientTable %}
            <tr>
              <td><a href="/patient/{{row['Patient']}}/">{{row['Patient']}}</a></td>
              <td>{{row['Subtype']}}</td>
              <td>{{row['# samples']}}</td>
              <td>{{row['1st sample']}}</td>
              <td>{{row['last sample']}}</td>
              <td><span class="glyphicon glyphicon-stop" style="color:{{colors[row['Patient']]}}"></span></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <div class="col-md-6">

      <h5 class="text-muted" style="text-align:center">
        <b>Example:</b> Phylogeny of samples in the <strong>{{region}}</strong> region, colored by patient.
      </h5>
      <div align="center">
       <svg id="treeSvgAll" style="max-width:80%"></svg>

       <h5 class="text-muted" style="text-align:center">Reference sequences are colored black.</h5>
     </div>
   </div>
 </div>
</div>
</div>
<!-- NOTE: the tag below is a trick for the tree plot -->
<div id="switchColorLinkPatient" class="active"></div>
{% endblock %}


