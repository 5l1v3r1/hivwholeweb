{% extends "base.html" %}
{% block head_end %}
{{ super() }}
<!-- display message if javascript is disabled -->
<noscript>
    <div class="bg-danger" style="margin-left:50px; margin-right:50px; margin-top:20px;
   margin-bottom:20px; padding-top:20px; padding-left:20px; padding-bottom:20px">
		<p class="text-danger"><strong>Warning:</strong> You don't have JavaScript activated. For full functionality of our site JavaScript has to be enabled.</p>
		<a href="http://www.enable-javascript.com/" target="_blank">How to enable JavaScript?</a>
    </div>
</noscript>

 <!-- D3.js for plots -->
 <link href="/static/css/d3_plots.css" rel="stylesheet" type="text/css">
 <script src="/static/components/d3/d3.js" charset="utf-8"></script>

 <!-- d3-tip for tooltips -->
 <link rel="stylesheet" href="/static/css/d3-tip.css">
 <script type="text/javascript" src="/static/components/d3-tip/index.js"></script>

 <!-- maybe we have to put the snippet directly into single scripts, let's hope not -->
 <script type="text/javascript">
  <!-- nice IE has no way of finding a string in a list of strings (!) -->
  if (!Array.prototype.indexOf) {
     Array.prototype.indexOf = function(item) {
        var i = this.length;
        while (i--) {
           if (this[i] === item) return i;
        }
        return -1;
     }
  }

 <!-- JavaScript has no intrinsic way to determine numeric -->
 function isNumeric(n) {
   return !isNaN(parseFloat(n)) && isFinite(n);
 }
 </script>


<script type="text/javascript" src="/static/js/trees.js"></script>
<script type="text/javascript">
function load_single(id, pname, region) {
 d3.xhr("/trees/")
  .header("Content-Type", "application/json")
  .post(
    JSON.stringify({patient: pname, region: region, treeFormat: "json"}),
    function(error, request) {
     var data = JSON.parse(request.responseText);
     data.id = id;
     data.pname = pname;
     data.region = region;
     data.leafLabels = false;

     var treefn = data.tree;

     d3.json(treefn, function(error, tree) {
      data.tree = tree;      
      update(data);
     });     
    });
}

function load() {
 load_single("all", "all", "{{region}}");
}
</script>
{% endblock %}
{% block body_attributes %}onload="load()"{% endblock %}
{% block content %}
<div class="container" style="padding-top:20px">
    <div class="jumbotron">
		<h2><b>HIV EVO</b></h2>
		<p style="text-align:justify; margin-left:50px; margin-right:50px">
We study genetic evolution of HIV during chronic infection on eleven patients, with nine time points per patient spanning a decade. The virus was sequenced whole-genome with a coverage of several thousand. We built this website as a resource for the HIV research community.<br>
<!--If it is the first time you are visiting this page we recommend to get started with our <a href="/tutorial/">tutorial</a>.<br>
For getting an overview on our data provided on this site per patient, go to the next section containing patient specific data.<br>
Advanced users might take a look on our download section to get the complete datasets.-->
		</p>
	</div>
	<div class="row">
		<h3><span class="glyphicon glyphicon-user"></span> Patients</h3>
<hr>
<div class="well">
<b>How to get started:</b><br>
Select a patient in the following table or in the tree on the right to get more specific data. Click <a href="/patient/p1/">here</a> to show data of patient p1. 
</div>
		<div class="col-xs-6">
<table class="table table-condensed">
<thead>
<tr>
<th rowspan = "2">patient</th>
<th rowspan = "2">subtype</th>
<th rowspan = "2">&#35; samples</th>
<th rowspan = "2">1st sample</th>
<th rowspan = "2">last sample</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td colspan = "2" align="center">[days since infection]</td>
</tr>
{% for row in patientTable %}
<tr>
<!-- TODO patient needs to get clickable! -->
<td><a href="/patient/{{row['Patient']}}/">{{row['Patient']}}</a></td>
<td>{{row['Subtype']}}</td>
<td>{{row['# samples']}}</td>
<td>{{row['1st sample']}}</td>
<td>{{row['last sample']}}</td>
</tr>
{% endfor %}
</tbody>
</table>

</div>
<div id="treeDivall" class="col-xs-6 col-sm-4">
<svg id="treeSvgall"></svg>
<p>Phylogenetic tree of all samples in the <strong>{{region}}</strong> region, colored by subtype.</p>
</div>
<div class="row">
  <div class="col-xs-12">
    <h4>Populationgenetics and Evolution</h4>
    bla
  </div>
</div>
<div class="row">
  <div class="col-xs-12">
    <h4>Data access</h4>
    bla
  </div>
</div>
</div>
<!-- NOTE: the tag below is a trick for the tree plot -->
<div id="switchColorLinkSubtype" class="active"></div>
{% endblock %}


