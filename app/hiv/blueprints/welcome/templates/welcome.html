{% extends "base.html" %}
{% block head_end %}
{{ super() }}
<!-- display message if javascript is disabled -->
<noscript>
    <div class="bg-danger" style="margin-left:50px; margin-right:50px; margin-top:20px;
   margin-bottom:20px; padding-top:20px; padding-left:20px; padding-bottom:20px">
		<p class="text-danger"><strong>Warning:</strong> You don't have JavaScript activated. For full functionality of our site JavaScript has to be enabled.</p>
		<a href="http://www.enable-javascript.com/" target="_blank">How to enable JavaScript?</a>
    </div>
</noscript>

 <!-- D3.js for plots -->
 <link href="/static/css/d3_plots.css" rel="stylesheet" type="text/css">
 <script src="/static/components/d3/d3.js" charset="utf-8"></script>

 <!-- d3-tip for tooltips -->
 <link rel="stylesheet" href="/static/css/d3-tip.css">
 <script type="text/javascript" src="/static/components/d3-tip/index.js"></script>

 <!-- maybe we have to put the snippet directly into single scripts, let's hope not -->
 <script type="text/javascript">
  <!-- nice IE has no way of finding a string in a list of strings (!) -->
  if (!Array.prototype.indexOf) {
     Array.prototype.indexOf = function(item) {
        var i = this.length;
        while (i--) {
           if (this[i] === item) return i;
        }
        return -1;
     }
  }

 <!-- JavaScript has no intrinsic way to determine numeric -->
 function isNumeric(n) {
   return !isNaN(parseFloat(n)) && isFinite(n);
 }
 </script>


<script type="text/javascript" src="/static/js/trees.js"></script>
<script type="text/javascript">
function load_single(id, pname, region) {
 d3.xhr("/trees/")
  .header("Content-Type", "application/json")
  .post(
    JSON.stringify({patient: pname, region: region, treeFormat: "json"}),
    function(error, request) {
     var data = JSON.parse(request.responseText);
     data.id = id;
     data.pname = pname;
     data.region = region;
     data.leafLabels = false;

     var treefn = data.tree;

     d3.json(treefn, function(error, tree) {
      data.tree = tree;      
      update(data);
     });     
    });
}

function load() {
 load_single("all", "all", "{{region}}");
}
</script>
{% endblock %}
{% block body_attributes %}onload="load()"{% endblock %}
{% block content %}
<div class="container" style="padding-top:20px; padding-left:20px">
    <div class="jumbotron">
		<h2 class="text-primary"><b>HIV EVO </b><small>Intrapatient HIV evolution</small></h2>
	</div>
	<div class="row">
		<div class="col-xs-6">
		<h4 class="text-muted"><span class="glyphicon glyphicon-info-sign"></span> About</h4>
<p style="text-align:justify">
We study genetic evolution of HIV during chronic infection on eleven patients, with nine time points per patient spanning a decade. The virus was sequenced whole-genome with a coverage of several thousand. We built this website as a resource for the HIV research community.</p>
		</div>
		<div class="col-xs-6">
		<h4 class="text-muted"><span class="glyphicon glyphicon-question-sign"></span> How to get started</h4>

<p style="text-align:justify">The provided data can be browsed by <a href="">patient</a>, <a href="">region</a> or <a href="">methods of analysis</a>. If it is the first time you are visiting this website we recommend to start with our <a href="/tutorial/">tutorial</a>. Advanced users might take a look at our <a href="">download section</a> to get specific datasets.</p>
		</div>
	</div>
<hr>
	<div class="row">
		<h4 class="text-primary"><span class="glyphicon glyphicon-user" style="padding-left:15px"></span> Patients</h4>
<div class="well text-muted" style="width:72%; margin-left:15px">
<span class="glyphicon glyphicon-arrow-right"></span> Select a patient in the following table to get more specific data. Click <a href="/patient/p1/">here</a> to show data of patient p1. 
</div>
		<div class="col-xs-8">
<p>Overview of patient specific data:</p>
<table class="table table-condensed">
<thead>
<tr>
<th rowspan = "2">patient</th>
<th rowspan = "2">subtype</th>
<th rowspan = "2">&#35; samples</th>
<th rowspan = "2">1st sample</th>
<th rowspan = "2">last sample</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td colspan = "2" align="center">[days since infection]</td>
</tr>
{% for row in patientTable %}
<tr>
<td><a href="/patient/{{row['Patient']}}/">{{row['Patient']}}</a></td>
<td>{{row['Subtype']}}</td>
<td>{{row['# samples']}}</td>
<td>{{row['1st sample']}}</td>
<td>{{row['last sample']}}</td>
</tr>
{% endfor %}
</tbody>
</table>

</div>
<div id="treeDivall" class="col-xs-4 col-sm-4">
<svg id="treeSvgall"></svg>
<p style="margin-left:30px; text-align:justify">Interactive phylogenetic tree of all samples in the <strong>{{region}}</strong> region, colored by subtype.</p>
</div>
<div class="row">
  <div class="col-xs-12">
	<h4 class="text-primary"><span class="glyphicon glyphicon-globe"></span> Regions</h4>
<hr>

   </div>
</div>
<div class="row">
  <div class="col-xs-12">
   <h4 class="text-primary"><span class="glyphicon glyphicon-book"></span> Methods of analysis</h4>
<hr>

  </div>
</div>
<div class="row">
  <div class="col-xs-12">
	<h4 class="text-primary"><span class="glyphicon glyphicon-download-alt"></span> Data access</h4>
<hr>

  </div>
</div>

<!-- container end -->
</div>
<!-- NOTE: the tag below is a trick for the tree plot -->
<div id="switchColorLinkSubtype" class="active"></div>
{% endblock %}


