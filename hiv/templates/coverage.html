{% extends "base.html" %}
{% block head_end %}
 <!-- D3.js for plots -->
 <link href="/static/css/d3_plots.css" rel="stylesheet" type="text/css">
 <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

 <!-- typsy (patched for D3.js) for fancy tiptools -->
 <link href="/static/css/tipsy.css" rel="stylesheet" type="text/css" />
 <script type="text/javascript" src="/static/js/jquery.tipsy.js"></script>
 <!-- jQuery is also required, but we load it in the base template (bootstrap needs it too) -->
{% endblock %}
{% block content %}

{% for plot_dict in plot_dicts %}
 <svg class="d3-plot {{ plot_dict.fragment }}"></svg>
 <script>
 var data = {{ plot_dict.data }}
 
 var margin = {top: 40, right: 30, bottom: 50, left: 60},
     width = 500 - margin.left - margin.right,
     height = 500 - margin.top - margin.bottom;
 
 var y = d3.scale.linear()
      .domain([0, d3.max(data)])
      .range([height, 0]);
 
 var x = d3.scale.linear()
      .domain([0, data.length])
      .range([0, width]);
 
 var xAxis = d3.svg.axis()
     .scale(x)
     .orient("bottom");
 
 var yAxis = d3.svg.axis()
     .scale(y)
     .orient("left");
 
 var {{ plot_dict.chart }} = d3.select(".{{ plot_dict.fragment }}")
     .attr("width", width + margin.left + margin.right)
     .attr("height", height + margin.bottom + margin.top)
     .append("g")
     .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
 
 {{ plot_dict.chart }}.append("text")
     .attr("class", "d3-title")
     .attr("x", width / 2)
     .attr("y", -20)
     .text("{{ plot_dict.fragment }}");
 
 {{ plot_dict.chart }}.append("g")
     .attr("class", "d3-axis")
     .attr("transform", "translate(0," + height + ")")
     .call(xAxis)
     .append("text")
     .attr("x", width / 2)
     .attr("y", 40)
     .style("text-anchor", "middle")
     .text("Position [bp]");
 
 {{ plot_dict.chart }}.append("g")
     .attr("class", "d3-axis")
     .call(yAxis)
     .append("text")
     .attr("transform", "rotate(-90)")
     .attr("y", -50)
     .attr("x", -230)
     .style("text-anchor", "middle")
     .text("Coverage");

 {{ plot_dict.chart }}.selectAll("g")
     .data(data)
     .enter()
     .append("circle")
     .attr("cy", function(d, i) { return y(d); })
     .attr("cx", function(d, i) { return x(i); })
     .attr("r", 2)
     .on("mouseover", function(d, i) {
       d3.select(this)
       .attr("r", 10);
       return ;
     })
     .on("mouseout", function(d, i) {
       d3.select(this)
       .attr("r", 2);
       return ;
     })
     .append('svg:title')
     .text(function(d, i) {
       return "Position: (" +  i + ", " + d + ")";
     });


$('svg circle').tipsy({ 
   gravity: 'w', 
   html: true, 
 });

   
 </script>
{% endfor %}

 <div class="form_options">
  <hl>Select options:</hl>
  <form action="" method="post" name="coverage_settings">
   {{form.hidden_tag()}}
   <p>
     Fragments: F1 {{form.F1}} F2 {{form.F2}} F3 {{form.F3}} F4 {{form.F4}} F5 {{form.F5}} F6 {{form.F6}}
     <br>
   </p>
   <p><input type="submit" value="Plot"></p>
  </form>
 </div>
{% endblock %}

